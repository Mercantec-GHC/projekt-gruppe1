@page "/houses/{id:int}"
@inject IBoligService BoligService
<div class="main-wrapper">
    <!-- Banner Section Start -->
    <section class="inner-page-breadcrumb">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="breadcrumb-content position-relative">
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-white">Home</a></li>
                            <li class="breadcrumb-item active text-white" aria-current="page">Detalje</li>
                        </ul>
                        <h1 class="breadcrumb-title text-white">@house?.Title</h1>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="property-listing-title">
        <div class="container">
            <div class="row align-items-baseline">
                <div class="col-lg-7">
                    <div class="d-md-flex align-items-baseline property-title">
                        <div class="property-title">
                            <h1 class="font-30">@house?.Title</h1>
                            <p class="mb-0">@house?.Location</p>
                        </div>

                        <div class="property-tag ms-md-auto ms-lg-3">
                            <ul class="list-inline">
                                <li class="bg-orange list-inline-item">Til sælg</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="d-md-flex align-items-center property-amnt">
                        <h2 class="font-30">@house?.Price/<span>dkk</span></h2>
                        <ul class="list-inline mt-3 mt-md-0 mb-0 ms-md-auto property-options">
                            <li class="list-inline-item">
                                <a href="#"><i class="fas fa-share-alt"></i></a>
                            </li>
                            <li class="list-inline-item">
                                <a href="javascript:void(0)" onclick="window.print()"><i class="fas fa-print"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="row">
            <div class="col-md-12 mb-4">
                <div class="d-flex flex-wrap gap-3">
                    @if (house != null && house.Pictures != null && house.Pictures.Any())
                    {
                        @foreach (var image in house.Pictures)
                        {
                            <div class="property-item">
                                <img src="@image.PictureLink" alt="Image" class="img-fluid w-100 fe-pro-img" />
                            </div>
                        }
                    }
                    else
                    {
                        <p>No images available.</p>
                    }
                </div>
            </div>
        </div>
    </div>

 
    <section class="property-details-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-lg-8">
                    <div class="property-description mb-5">
                        <h4 class="border-bottom pb-3 mb-4 font-20">Besktivelse</h4>
                        <p>@house?.Description</p>
                    </div>

                    <div class="property-details mb-5">
                        <h4 class="border-bottom pb-3 mb-4 font-20">Bolig detajler</h4>
                        <div class="row">
                            <div class="col-md-6 col-lg-6">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Bolig :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">Til sælg</div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Bolig storelse :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">@house?.SquareMeters Sq Ft</div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Year Built :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">@house?.Year</div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Etage :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">@house?.NumberOfFloors</div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Garage :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">
                                        @(house?.HasGarage == true ? "Ja" : "Nej")
                                    </div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Haven :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">
                                        @(house?.HasGarden == true ? "Ja" : "Nej")
                                    </div>

                                    <div class="col-lg-6 col-md-6 col-6 mb-2">Værelser :</div>
                                    <div class="col-lg-6 col-md-6 col-6 mb-2 text-alter font-averta-bold">@house?.RoomsCount</div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="related-property-section mb-5">
                        <h4 class="border-bottom pb-3 mb-4 font-20">Lignende tilbud</h4>

                        <div class="related-property">
                            <div class="row">
                                @if (houses != null && houses.Any() )
                                {
                                    @foreach(var house in houses.Where(i => i.Id != house.Id).Take(2))
                                        {
                                            var firstImage = house.Pictures?.FirstOrDefault()?.PictureLink;
                                            <div class="col-md-6">
                                                <div class="card related-property-card mb-4">
                                                    <div class="related-property-img position-relative">
                                                        <img src="@firstImage" alt="featured-property" class="img-fluid w-100 related-pro-img" />
                                                        <div class="property-details mb-2">
                                                            <h4 class="text-white mb-0">@((int)house.Price)/<span>dkk</span></h4>
                                                            <div class="property-view ms-auto">
                                                                <a href="#"><i class="fas fa-exchange-alt"></i></a>
                                                                <a href="#"><i class="far fa-heart"></i></a>
                                                            </div>
                                                        </div>
                                                        <div class="property-tag">
                                                            <ul class="list-unstyled mb-0">
                                                                <li class="bg-blue">Til sælg</li>
                                                            </ul>
                                                        </div>
                                                        <span class="featured-property me-2 text-white bg-green"><i class="fas fa-star font-12"></i></span>
                                                        <span class="hot-property me-2 text-white bg-orange"><i class="fas fa-fire font-12"></i></span>
                                                    </div>
                                                </div>
                                                <div class="card-body d-flex flex-column">
                                                    <p class="text-orange mb-0">Lejlighed</p>
                                                    <h4 class="font-20 product-title">
                                                        <a href="@($"/houses/{house.Id}")" class="text-decoration-none">@house.Title</a>
                                                    </h4>
                                                    <p><i class="fas fa-map-marker-alt"></i> @house.Location</p>
                                                    <ul class="list-unstyled d-flex justify-content-between mb-0 mt-auto">
                                                        <li>
                                                            <p class="mb-0">@house.RoomsCount <i class="fas fa-bed"></i></p>
                                                            badeværelse
                                                        </li>
                                                        <li>
                                                            <p class="mb-0">@house.SquareMeters <i class="fas fa-vector-square"></i></p>
                                                            kvadratmeter
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="property-footer border-top">
                                                    <div class="card-body">
                                                        <div class="property-footer-meta d-flex align-items-center">
                                                            <div class="property-year ms-auto">
                                                                <p class="mb-0">@house.CreatedAt.ToString("d MMM yyyy")</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    }
                            </div>
                        </div>

                    </div>

                </div>
                <div class="col-md-12 col-lg-4">

                    <div class="sidebar-agent-form mb-4 pb-1">
                        <div class="card">
                            <div class="agent-profile-image">
                                <img src="assets/images/agents/team-member1.jpg" alt="agent-img">
                                <h4 class="font-20 mt-3">Johnathan Doe</h4>
                                <p>Property Agent</p>
                            </div>
                            <div class="card-body p-4 border-bottom pb-2">
                                <div class="agent-contact-detail-sidebar">
                                    <p><i class="fas fa-phone-square-alt me-3 text-orange"></i>9876543210</p>
                                    <p><i class="fas fa-envelope-square me-3 text-orange"></i><a href="#" class="text-decoration-none">johnathandoe@gmail.com</a></p>
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <div class="agent-contact-form-sidebar">
                                    <form id="agent-form" name="agent-form" method="POST">
                                        <input type="text" id="fname" name="full_name" class="form-control mb-3 font-14" placeholder="Full Name" required="">
                                        <input type="text" id="pnumber" name="p_number" class="form-control mb-3 font-14" placeholder="Phone Number" required="">
                                        <input type="email" id="emailid" name="email_address" class="form-control mb-3 font-14" placeholder="Email Address" required="">
                                        <textarea rows="5" name="message" class="form-control mb-3 font-14" placeholder="I'm interest in..." required=""></textarea>

                                        <input type="submit" name="request" class="btn btn-warning w-100 agent-contact-btn" value="Submit Request">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer id="footer" class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-4">
                    <div class="footer-about">
                        <h3 class="font-18 text-white">About Site</h3>
                        <p class="mt-4 pt-2 pe-4">Real Homes is a premium WordPress theme for real estate where modern aesthetics are combined with tasteful simplicity.</p>
                        <a href="#" class="text-body text-decoration-none">Read More <i class="fas fa-chevron-right ms-2"></i></a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 mt-4 mt-md-0">
                    <h3 class="font-18 text-white">Contact Us</h3>
                    <p class="mt-4 pt-2 pe-5 d-flex mb-3"><i class="fas fa-map-marker-alt mt-1 font-22 me-3"></i>4417 Langtown Road, Davenport, Iowa</p>
                    <p class="pe-5 d-flex mb-3"><i class="fab fa-whatsapp mt-1 font-22 me-3"></i>+123-456-789</p>
                    <p class="pe-5 d-flex mb-3"><i class="fas fa-phone-alt mt-1 font-22 me-3"></i>+123-456-789</p>
                    <p class="pe-5 d-flex mb-3"><i class="fas fa-envelope mt-1 font-22 me-3"></i>sales@example.com</p>
                </div>
                <div class="col-md-12 col-lg-4 mt-4 mt-lg-0">
                    <h3 class="font-18 text-white">Remain Updated</h3>
                    <form class="nl-form mt-4 pt-2">
                        <input type="email" class="form-control" id="email">
                        <button type="submit" class="btn btn-warning py-2 px-4 mt-3">Submit</button>
                    </form>
                    <ul class="list-unstyled list-inline footer-social-link mt-4 pt-3">
                        <li class="list-inline-item">
                            <a href="#"><i class="fab fa-facebook-f font-22"></i></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#"><i class="fab fa-instagram font-22"></i></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#"><i class="fab fa-twitter font-22"></i></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#"><i class="fab fa-youtube font-22"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom row">
                <div class="col-md-4 col-lg-6">
                    <p>© 2023. All rights reserved.</p>
                </div>
                <div class="col-md-8 col-lg-6 text-md-end">
                    <ul class="list-inline footer-link">
                        <li class="list-inline-item">
                            <a href="#" class="text-decoration-none">Contact Us</a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#" class="text-decoration-none">FAQ</a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#" class="text-decoration-none">Privacy</a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#" class="text-decoration-none">Terms & Conditions</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</div>


@code {
    private House? house;
    private List<House?> houses;
    [Parameter]
    public int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            houses = await BoligService.GetAllHouses();
            house = houses?.FirstOrDefault(i => i.Id == Id);

            if (house != null)
            {
                house.Pictures = (await BoligService.GetAllPictures()).Where(i=> i.PropertyId == Id).ToList();
            }

            foreach(var house in houses)
            {
                house.Pictures = (await BoligService.GetAllPictures()).Where(i => i.PropertyId == house.Id).ToList();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading data: {ex.Message}");
        }
    }
}
